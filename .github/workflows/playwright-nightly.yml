name: Playwright Report Email
on: [schedule: - cron: '0 0 * * *']  # Nightly

jobs:
  send-report:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with: { node-version: '20', cache: 'yarn' }
      - run: yarn install --frozen-lockfile
      - run: npx playwright install --with-deps
      - run: npx playwright test
        env: { CI: true }
      - name: Zip Report
        run: zip -r report.zip playwright-report/ || true
      - name: Send via SendGrid
        uses: dawidd6/action-send-mail@v4
        with:
          server_address: smtp.sendgrid.net
          server_port: 587
          username: apikey
          password: ${{ secrets.SENDGRID_API_KEY }}
          to: ${{ secrets.SENDGRID_TO }}
          from: "${{ secrets.SENDGRID_FROM }}"  # Verified!
          subject: "Playwright Report - ${{ job.status }}"
          body: "Run: $$ {{ github.server_url }}/ $${{ github.repository }}/actions/runs/${{ github.run_id }}"
          attachments: report.zip